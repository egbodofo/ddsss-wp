"use strict";!function(_){var m={init:function(){var e=this,t=_(document);t.on("click","#hb_room_load_booking_form",e.load_room_add_to_cart_form),t.on("hotel_room_load_add_to_cart_form_open",e.lightbox_init),t.on("submit",".hotel-booking-single-room-action",e.form_submit),t.on("click",".hb_previous_step",e.preStep)},is_int:function(e){return Number(e)&&e%1==0},lightbox_init:function(e,t,o,a){e.preventDefault(),"hb-room-load-form"===a&&m.datepicker_init()},form_submit:function(e){e.preventDefault();var t=_(this),o=t.attr("name"),a=m.form_data();"hb-search-single-room"===o&&m.check_avibility(t,a,t.find('button[type="submit"]'))},datepicker_init:function(){var e,o=_('.hb-search-results-form-container input[name="check_in_date"]'),a=_('.hb-search-results-form-container input[name="check_out_date"]'),t=new Date,n=new Date,i=_(document).triggerHandler("hotel_booking_min_check_in_date"),r=hotel_settings.min_booking_date;e=r,Number(e)||e%1==0||(r=1),m.is_int(i)||(i=1),n.setDate(t.getDate()+i),o.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:t,maxDate:"+365D",onSelect:function(e){var t=o.datepicker("getDate");new Date(t);t.setDate(t.getDate()+r),a.datepicker("option","minDate",t)},onClose:function(){a.datepicker("show")}}),a.datepicker({dateFormat:hotel_booking_i18n.date_time_format,monthNames:hotel_booking_i18n.monthNames,monthNamesShort:hotel_booking_i18n.monthNamesShort,dayNames:hotel_booking_i18n.dayNames,dayNamesShort:hotel_booking_i18n.dayNamesShort,dayNamesMin:hotel_booking_i18n.dayNamesMin,minDate:n,maxDate:"+365D",onSelect:function(e){var t=a.datepicker("getDate");new Date(t);t.setDate(t.getDate()-r),o.datepicker("option","maxDate",t)}}),_(document).triggerHandler("hotel_booking_room_form_datepicker_init",o,a)},beforeAjax:function(e){e.addClass("hb_loading"),_(document).triggerHandler("hotel_booking_room_form_before_ajax")},afterAjax:function(e){e.removeClass("hb_loading"),_(document).triggerHandler("hotel_booking_room_form_after_ajax")},load_room_add_to_cart_form:function(e){e.preventDefault();var t=_(this),o=t.attr("data-id"),a=t.attr("data-name"),n=_(document),i="hb-room-load-form",r="#hotel_booking_room_hidden";return _(r).html(wp.template(i)({_room_id:o,_room_name:a})),_.magnificPopup.open({type:"inline",items:{src:"#hotel_booking_room_hidden"},callbacks:{open:function(){n.triggerHandler("hotel_room_load_add_to_cart_form_open",[t,r,i])}}}),!1},check_avibility:function(t,e,o){!1!==m.sanitize()&&_.ajax({url:hotel_settings.ajax,contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"POST",data:e,dataType:"json",beforeSend:function(){m.beforeAjax(o)}}).done(function(e){m.afterAjax(o),void 0!==e.status&&(!1===e.status&&void 0!==e.messages?m.append_messages(t,e.messages):void 0!==e.qty&&(void 0!==e.qty.errors?alert(e.qty.errors.zero):t.replaceWith(wp.template("hb-room-load-form-cart")(e))))}).fail(function(){m.afterAjax(o)})},preStep:function(e){var t=_(this),o=t.attr("data-template"),a=t.parents("form:first-child"),n=m.form_data();return t.addClass("hb_loading"),a.replaceWith(wp.template(o)(n)),t.removeClass("hb_loading"),m.datepicker_init(),!1},sanitize:function(){var e=_('form[name="hb-search-single-room"]'),t=e.find('input[name="check_in_date"]'),o=e.find('input[name="check_out_date"]'),a=[];return null===t.datepicker("getDate")&&(t.addClass("error"),a.push("<p>"+hotel_booking_i18n.empty_check_in_date+"</p>")),null===o.datepicker("getDate")&&(o.addClass("error"),a.push("<p>"+hotel_booking_i18n.empty_check_out_date+"</p>")),0<a.length?(m.append_messages(e,a),!1):(m.append_messages(e),!0)},form_data:function(){for(var e={},t=_(".hotel-booking-single-room-action"),o=t.serializeArray(),a=Object.keys(o).length,n=0;n<a;n++){var i=o[n];if("check_in_date"===i.name||"check_out_date"===i.name){var r=t.find('input[name="'+i.name+'"]');r=_(r).datepicker("getDate"),r=(r=new Date(r)).getTime()/1e3-60*r.getTimezoneOffset(),e[i.name+"_timestamp"]=r}e[i.name]=i.value}return e},append_messages:function(e,t){if(void 0!==e&&(e.find(".hotel_booking_room_errors").slideUp(300,function(){_(this).remove()}),e.find(".error").removeClass("error")),void 0!==e&&void 0!==t&&0!==Object.keys(t).length){for(var o=[],a=0;a<Object.keys(t).length;a++)o[a]="<p>"+t[a]+"</p>";e.find(".hb-booking-room-form-head").append('<div class="hotel_booking_room_errors">'+t.join("")+"</div>")}}};_(document).ready(function(){m.init()})}(jQuery);